
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#ab2923">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="csrf-token" content="c03d3687b801e546dd98987b409c944b2e8702c9">
  <meta name="google-site-verification" content="c_LAXHEHxcNq1-aJO5h6KHVhmuVz7pgsfx9HbbN7BXg" />
    <meta name="description"
    content="Fastest and easiest way to convert your airtime to cash. Accept payments for your business and services today using airtime." />
  
    <meta name="keywords"
    content="Easiest way to convert airtime to cash in Nigeria, Make payment with airtime, Send and recieve payment in Nigeria with airtime, airtime is money, buy cheap data, MTN, Glo, 9mobile, Airtel, make payment for Gotv, Dstv" />
    <meta property="og:image" content="https://aimtoget.com/assets/images/new/favicon.png">
  <title>History
</title>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/styles.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2.5/fonts.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/iziToast.min.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/sweetalert2.min.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/fontawesome-free-6.1.2-web/css/all.min.css">
  <link rel="icon" href="https://aimtoget.com/assets/images/new/atg-favicon.png">
  <script src="https://aimtoget.com/assets/js/v2/alpine.persist.min.js" defer></script>
  <script src="https://aimtoget.com/assets/js/v2/alpine.intersect.min.js" defer></script>
  <script defer src="https://aimtoget.com/assets/js/v2/alpine.min.js"></script>
  <script src="https://aimtoget.com/assets/js/axios.min.js?v=2.5.6998"></script>
  <script>const BASE_URL = 'https://aimtoget.com';</script>
  <script src="https://aimtoget.com/assets/js/v2/iziToast.min.js?v=2.5.6998"></script>
  <script src="https://aimtoget.com/assets/js/v2/sweetalert2.all.min.js?v=2.5.6998"></script>
  <script src="https://aimtoget.com/assets/js/v2/utils.js?v=2.5.6998"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90432823-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-90432823-1');
  </script>

    </head>

<body
  class="bg-white font-body"
  :class="(sidebar_open || is_fund_modal_open) ? 'overflow-hidden h-full' : ''"
  x-init="() => {
    $refs.sidebar.classList.remove('-left-72')
  }"
  x-data="{
    sidebar_open:false,
    is_fund_modal_open: false,
    openNairaPin() {
      Notify.error(
        'Service Unavailable!',
        'Naira pin is currently unavailable. Please check back later.'
      )
    }
  }">
  <aside
    x-ref="sidebar"
    class="fixed inset-y-0 px-6 py-5 text-sm text-gray-800 duration-300 bg-gray-100 border-r -left-72 lg:left-0 w-72"
    :class="sidebar_open ? 'left-0 z-40' : '-left-72 lg:left-0'">
    
    <div class="p-5 bg-white rounded-lg shadow">
      <div class="flex items-center justify-between">
        <div>
          <a href="">
            princejboy
          </a>
        </div>
        <div>
          <a href="https://aimtoget.com/app/logout">
            <i class="fa fa-power-off"></i>
          </a>
        </div>
      </div>
    </div>

    <ul class="mt-10 space-y-8">
      <li>
        <ul class="space-y-4">
          <li>
            <a
              class="block duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app">
              <i class="fas fa-tachometer-alt"></i>
              <span class="inline-block ml-1">
                Dashboard
              </span>
            </a>
          </li>
          <li>
            <a
              class="block duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/transactions">
              <i class="far fa-list-alt"></i>
              <span class="inline-block ml-1">
                Transaction History
              </span>
            </a>
          </li>
                  </ul>
      </li>

      <li>
        <div class="font-medium text-gray-500">
          Main
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              href=""
              @click.prevent="sidebar_open = false; is_fund_modal_open = true"
              class="duration-300 hover:text-primary-main">
              <i class="fab fa-pushed"></i>
              <span class="inline-block ml-1">
                Fund Wallet
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/airtime/fund">
              <i class="fas fa-crosshairs"></i>
              <span class="inline-block ml-1">
                Airtime To Cash
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/withdraw">
              <i class="fa fa-university"></i>
              <span class="inline-block ml-1">
                Withdraw Funds
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/transfer">
              <i class="fa fa-arrow-right"></i>
              <span class="inline-block ml-1">
                Transfer Funds
              </span>
            </a>
          </li>
        </ul>
      </li>

      <li>
        <div class="font-medium text-gray-500">
          Services
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/airtime">
              <i class="fas fa-signal"></i>
              <span class="inline-block ml-1">
                Airtime Topup
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/data">
              <i class="fas fa-wifi"></i>
              <span class="inline-block ml-1">
                Data Topup
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/bills">
              <i class="fas fa-money-bill-wave-alt"></i>
              <span class="inline-block ml-1">
                Pay Bills
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href=""
              @click.prevent="openNairaPin">
              <i class="fas fa-credit-card"></i>
              <span class="inline-block ml-1">
                Naira Pin
              </span>
            </a>
          </li>
        </ul>
      </li>

      <li>
        <div class="font-medium text-gray-500">
          Settings
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/settings">
              <i class="fas fa-cog"></i>
              <span class="inline-block ml-1">
                Account Settings
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="https://aimtoget.com/app/logout">
              <i class="fas fa-power-off"></i>
              <span class="inline-block ml-1">
                Logout
              </span>
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </aside>
  <main class="lg:ml-72">
    <header class="fixed inset-x-0 top-0 z-10 px-5 py-3 bg-white border-b lg:z-0 lg:relative">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-x-5">
          <div class="flex items-center lg:hidden">
            <a 
              href="" 
              @click.prevent="sidebar_open = !sidebar_open"
              class="flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full">
              <i class="fas fa-bars"></i>
            </a>
          </div>
          <div>
            <a href="https://aimtoget.com/app">
              <img
                class="h-6 lg:h-7"
                src="https://aimtoget.com/assets/images/new/aimtoget-logo.svg"
                alt="">
            </a>
          </div>
        </div>
        <div class="flex items-center gap-x-3 lg:gap-x-5">
          <a
            x-data="{
              show_balance: $persist(false).as('atg_balance_show')
            }"
            x-init="() => {
              window.addEventListener('show_hide_balance', e => {
                show_balance = !show_balance
              })
            }"
            @click.prevent="show_balance = !show_balance"
            href=""
            class="hidden px-2 py-1 text-sm text-white duration-300 rounded lg:block lg:px-3 lg:py-2 hover:bg-primary-600 bg-primary-main">
            â‚¦ 
            <span
              x-cloak
              :class="show_balance ? '' : 'hidden'">
              19,920.00
            </span>
            <span
              x-cloak
              :class="show_balance ? 'hidden' : ''">
              ******
            </span>
          </a>
          <a
            href="https://aimtoget.com/app/settings"
            class="px-1 text-gray-800 lg:text-xl lg:px-2 lg:py-1 hover:bg-gray-100 rounded-xl">
            <i class="fa fa-cog"></i>
          </a>
          <a
            href=""
            class="px-1 text-gray-800 lg:text-xl lg:px-2 lg:py-1 hover:bg-gray-100 rounded-xl">
            <i class="far fa-bell"></i>
          </a>
        </div>
      </div>
    </header>

        <div
      class="container relative z-0 px-5 pb-10 mx-auto mt-16 lg:mt-0">
      <h1 class="mt-10 text-2xl font-semibold">
  Transactions History
</h1>

<div
  x-init="() => {
    loadTransactions(1)
    $watch('selected_transaction', value => show_transaction = !!value)
    $watch('show_transaction', value => {
      if(!value) {
        selected_transaction = null
      }
    })
  }"
  x-data="{
    pages: {},
    limit: 10,
    reference: '',
    is_loading: false,
    is_link: false,
    transactions: [],
    show_transaction: false,
    selected_transaction: null,
    getTxnColor({ status }) {
      let colors = {
        Pending: 'text-yellow-600',
        Processing: 'text-yellow-600',
        Success: 'text-green-600',
        Failed: 'text-red-600',
        Reversed: 'text-orange-600'
      }

      return colors[status.name]
    },
    loadTransactions(page) {
      let { limit } = this
      let uri = utils.api_endpoint(`/me/transactions?page=${page}&limit=${limit}`)

      this.is_loading = true
      $http.get(uri)
        .then(({data}) => {
          let { status } = data

          if(status !== 'ok') {
            return
          }

          let { items, pages } = data.data
          this.pages = pages
          this.transactions = items
          this.open()
          window.scrollTo(0, 0)
        })
        .finally(() => this.is_loading = false)
    },
    open() {
      let { reference, transactions } = this
      this.reference = ''

      if(!reference) {
        return
      }

      let index = transactions.findIndex(txn => txn.reference_code === reference)
      let txn = transactions[index]

      if(!txn) {
        return
      }

      this.selected_transaction = txn
    },
    has_confirmed: false,
    confirmTransaction() {
      let { selected_transaction } = this

      if(!selected_transaction) {
        return
      }

      let reference = selected_transaction.reference_code
      let uri = utils.api_endpoint('/fund-airtime/confirm')
      this.is_loading = true

      $http.post(uri, { reference })
        .then(({data}) => {
          let { status } = data

          if(status === 'ok') {
            return this.showCompleteTransaction(data.data)
          }

          Notify.connectionError()
        })
        .catch(() => Notify.connectionError())
        .finally(() => this.is_loading = false)
    },
    showCompleteTransaction({ amount, amount_formatted, phone }) {
      Notify.confirm({
        title: 'Confirm transaction',
        text: `Are you sure you have transferred NGN${amount_formatted} to ${phone}?`,
        confirmText: 'Confirm',
        onConfirm: () => this.completeTransaction(),
        onCancel: () => this.declineTransaction()
      })
    },
    completeTransaction() {
      let { selected_transaction } = this
      if(!selected_transaction) return

      let ref_code = selected_transaction.reference_code
      let uri = utils.api_endpoint('/fund-airtime/complete')
      this.is_loading = true

      $http.post(uri, { ref_code })
        .then(({data}) => {
          if(data.status === 'ok') {
            return Notify.success(
              data.msg,
              data.data,
              () => this.has_confirmed = true
            )
          }

          if(data.status === 'error') {
            return Notify.error(
              data.msg,
              data.data
            )
          }

          Notify.connectionError()
        })
        .catch(() => Notify.connectionError())
        .finally(() => this.is_loading = false)
    },
    declineTransaction() {
      console.log('Should decline')
    }
  }"
  class="grid mt-5 lg:mt-10 lg:grid-cols-2">
  <div
    class="lg:border-r lg:border-gray-200 lg:pr-10 ">
    
    <div class="space-y-4">
      <template x-for="transaction in transactions">
        <div
  class="p-3 text-sm rounded-lg bg-gray-50">
  <a
    href=""
    @click.prevent="is_link ? location.href = 'https://aimtoget.com/app/transactions?o=' + transaction.reference_code : selected_transaction = transaction">
    <div class="flex items-center justify-between">
      <div class="flex">
        <div class="flex items-center">
          <div
            class="flex items-center justify-center w-8 h-8 mr-4 bg-gray-200 rounded-full"
            :class="transaction.action_type === 'Dr' ? 'text-red-600' : 'text-green-600'">
            <i
              class="rotate-45 fa"
              :class="transaction.action_type === 'Dr' ? 'fa-arrow-left' : 'fa-arrow-right'"></i>
          </div>
        </div>
        <div>
          <div x-text="transaction.type"></div>
          <div class="mt-1 text-xs font-light">
            <span
              class="text-gray-500"
              x-text="transaction.date"></span>
              &middot;
            <span
              class="font-normal text-gray-500"
              :class="getTxnColor(transaction)"
              x-text="transaction.status.name"></span>
          </div>
        </div>
      </div>
      <div
        x-text="transaction.amount_formatted"
        class="font-medium text-gray-600 lg:text-base"></div>
    </div>
  </a>
</div>      </template>
    </div>
    <div class="mt-5">
      <div class="flex items-center justify-end text-sm gap-x-5">
        <template x-if="pages.prev && !is_loading">
          <a
            @click.prevent="loadTransactions(pages.prev)"
            href=""
            class="inline-flex items-center justify-center px-3 py-1 space-x-2 duration-300 border rounded-lg hover:bg-gray-100">
            <i class="fa fa-angle-left"></i>
            <span>Prev</span>
          </a>
        </template>
        <div
          :class="is_loading ? 'hidden' : '' "
          class="text-gray-500"
          x-text="pages.page"></div>

        <template x-if="pages.next && !is_loading">
          <a
            @click.prevent="loadTransactions(pages.next)"
            href=""
            class="inline-flex items-center justify-center px-3 py-1 space-x-2 duration-300 border rounded-lg hover:bg-gray-100">
            <span>Next</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </template>
      </div>
    </div>
    <div
      class="flex justify-center"
      x-show="is_loading">
      <div class="p-3">
        <i class="fa fa-circle-notch fa-spin"></i>
        Loading...
      </div>
    </div>
  </div>
  <div class="hidden lg:block">
    <template x-if="!selected_transaction">
      <div class="flex items-center justify-center h-full text-gray-400">
        <div class="text-center">
          <div>
            <i class="fa fa-sticky-note fa-2x"></i>
          </div>
          <div class="mt-1 text-sm">
            Transaction will open here.
          </div>
        </div>
      </div>
    </template>
  </div>

  <template x-if="selected_transaction">
    <div
  x-cloak
  $ref="container"
  class="fixed inset-0 z-[100000] flex items-end justify-center bg-black lg:shadow-xl lg:items-center bg-opacity-70"
  x-show="show_transaction"
  id="show_transaction"
  x-transition
  x-transition.opacity
  @click="clicked($event)"
  x-data="{
    is_loading: false,
    close() {
      this.show_transaction = false
    },
    clicked({target}) {
      if(this.is_loading) {
        return
      }
      
      if(target.getAttribute('id') === 'show_transaction') {
        this.close()
      }
    }
  }">
  <div class="w-full p-10 bg-white rounded-lg lg:w-4/12 2xl:w-3/12">
    
<div class="flex items-center justify-between space-x-6">
  <div class"text-lg font-medium">
    Transaction Details
  </div>
  <a
    class="inline-flex items-center px-2 py-1 text-xs text-gray-600 bg-gray-100 border rounded-lg gap-x-2"
    @click.prevent="selected_transaction = null"
    href="">
    <i class="fa fa-times-circle"></i>
    <span>Close</span>
  </a>
</div>


<div class="max-h-[500px] lg:max-h-[550px] mt-6 overflow-y-scroll ">
  <div class="space-y-6 text-sm ">
    <div>
      <div class="text-xs">
        Amount:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.amount_formatted">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Status:
      </div>
      <div
        :class="getTxnColor(selected_transaction)"
        x-text="selected_transaction.status.name">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Date:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.datetime">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Reference:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.reference_code">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Type:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.type">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Method:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.method">
      </div>
    </div>
    <div>
      <div class="text-xs">
        Memo:
      </div>
      <div
        class="text-gray-500"
        x-text="selected_transaction.memo">
      </div>
    </div>
    <template x-if="selected_transaction?.metadata">
      <template x-for="(value, key) in selected_transaction.metadata">
        <div>
          <div class="text-sm" x-text="`${key}:`">
          </div>
          <div
            class="text-gray-500"
            x-text="value">
          </div>
        </div>
      </template>
    </template>
  </div>
</div>  </div>
</div>  </template>
</div>
    </div>
    
    
<div
  class="fixed inset-0 z-30 bg-black bg-opacity-60"
  :class="sidebar_open ? '' : 'hidden'"
  @click.prevent="sidebar_open = false" x-cloak></div>

<div
  x-cloak
  x-data="{
    is_copying: false,
    current_view: 1,
    views: {
      INDEX: 1,
      ATM_FUND: 2
    },
    close() {
      this.current_view = this.views.INDEX
      this.is_fund_modal_open = false
    },
    goto(uri) {
      this.close()
      location.href = uri
    },
    copyAccountNumber(acn) {
      navigator.clipboard.writeText(acn).then(() => {
        iziToast.success({
          message: 'Account number copied',
          position: 'topCenter',
          timeout: 3000
        })
      })
    }
  }"
  $ref="container"
  class="fixed inset-0 z-50 flex items-end justify-center bg-black lg:shadow-xl lg:items-center bg-opacity-70"
  x-show="is_fund_modal_open"
  x-transition
  x-transition.opacity>
  <div class="w-full p-10 bg-white rounded-lg lg:w-3/12">
    <div
      :class="current_view == views.INDEX ? '' : 'hidden'">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-semi-bold">
            Add Funds
          </div>
          <div class="text-sm font-light text-gray-500">
            How do you want to topup?
          </div>
        </div>
        <div>
          <a
            class="text-gray-500"
            @click.prevent="close"
            href="">
            <i class="fa fa-times-circle"></i>
          </a>
        </div>
      </div>
                  <div>
        <div class="flex items-center justify-between px-5 py-3 mt-5 bg-gray-100 border border-gray-300 rounded-lg">
          <div>
            <div class="text-xl font-semibold">
              2056667112
            </div>
            <div class="text-gray-600">
              Kuda Bank
            </div>
          </div>
          <div>
            <a
              @click.prevent="copyAccountNumber(2056667112)"
              href="">
              <i class="text-gray-600 fa fa-copy"></i>
            </a>
          </div>
        </div>
        <div class="mt-2">
          <div
            :class="is_copying ? '' : 'hidden'"
            class="text-xs text-atg">Account number copied...</div>
          <div class="text-xs text-gray-600">
            Transfer to this account to fund your wallet.
          </div>
        </div>
      </div>
            <div>
  
      </div>
      <ul class="mt-8 border-t">
        <li class="py-5 border-b border-gray-200">
          <a 
            href=""
            @click.prevent="goto('https://aimtoget.com/app/airtime/fund')">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">Airtime</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Convert your airtime to cash
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
        <li class="py-5 border-b border-gray-200">
          <a
            href=""
            @click.prevent="current_view = views.ATM_FUND">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">ATM Card</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Fund your wallet using ATM Card
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
        <li class="py-5 border-b border-gray-200">
          <a
            href=""
            @click.prevent="openNairaPin">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">Naira Pin</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Load Aimtoget wallet with naira-pin
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
      </ul>
    </div>
    <div
      :class="current_view === views.ATM_FUND ? '' : 'hidden'">
      <div class="flex items-center justify-between">
        <div class="text-sm">
          <a
            class="inline-block px-2 py-1 bg-gray-100 border rounded-lg"
            @click.prevent="current_view = views.INDEX"
            href="">
            <i class="fa fa-angle-left"></i>
            <span class="ml-1 text-gray-600">Back</span>
          </a>
        </div>
        <div>
          <a
            class="text-gray-500"
            @click.prevent="close"
            href="">
            <i class="fa fa-times-circle"></i>
          </a>
        </div>
      </div>
      <div class="mt-5">
        <div class="text-xl lg:text-2xl font-semi-bold">
          ATM Card
        </div>
        <div class="text-xs font-light text-gray-500 lg:text-sm">
          Add funds with ATM Card
        </div>
      </div>
      <div class="pt-10">
        <form
          action=""
          method="post"
          @submit.prevent="process"
          x-data="{
            cards: [],
            new_card_id: 'new_card',
            selected_card: {},
            amount: '',
            key: '',
            reference: '',
            is_loading: false,
            has_loaded_cards: false,
            process() {

              if(!this.reference) {
                return this.prepare()
              }

              if(!this.has_loaded_cards) {
                return
              }

              let { selected_card, new_card_id } = this

              if(selected_card.id === new_card_id) {
                return this.openPayment()
              }
              
              this.chargeSavedCard()
            },
            button_disabled() {
              if(this.amount < 1) {
                return true
              }

              if(this.is_loading) {
                return true
              }

              if(this.cards.length && !this.selected_card) {
                return true
              }

              return false
            },
            reset() {
              this.key = '',
              this.reference = '',
              this.is_loading = false
              this.amount = ''
            },
            prepare() {
              this.is_loading = true
              let { amount } = this
              let uri = utils.api_endpoint('/fund-atm/reference')
              
              $http.post(uri, {amount})
                .then(({data}) => {
                  let { status } = data

                  if(status === 'error') {
                    this.is_loading = false
                    return Notify.error(
                      data.msg,
                      data.data.msg
                    )
                  }

                  if(status === 'ok') {
                    let { amount, email, rave, reference } = data.data
                    this.email = email
                    this.reference = reference
                    this.key = rave.public_key
                    return this.loadSavedCards()
                  }
                })
                .catch(err => {
                  console.log(err)
                  this.is_loading = false
                  Notify.connectionError()
                })
            },
            loadSavedCards() {
              
              if(this.cards.length) {
                return
              }

              let uri = utils.api_endpoint('/me/cards')
              this.is_loading = true

              $http.get(uri)
                .then(({data}) => {
                  let { status } = data

                  if(status === 'ok') {
                    this.is_loading = false
                    this.cards = data.data.cards
                    this.has_loaded_cards = true
                    return
                  }
                  
                  this.openPayment()
                })
                .finally(() => {
                  has_loaded_cards = true
                })
            },
            chargeSavedCard() {
              let uri = utils.api_endpoint('/fund/card')
              let { reference, selected_card } = this
              let params = {
                reference,
                card: selected_card.id
              }

              this.is_loading = true
              $http.post(uri, params)
                .then(({data}) => {
                  let { status } = data

                  if(status === 'processing') {
                    return this.verifyCardChargeTxn()
                  }

                  this.is_loading = false

                  if(status === 'ok') {
                    return Notify.success(
                      data.msg,
                      data.data.msg,
                      () => {
                        this.reset()
                        this.close()
                      }
                    )
                  }

                  if(status === 'error') {
                    return Notify.error(
                      data.msg,
                      data.data.msg
                    )
                  }

                  Notify.connectionError()
                })
                .catch(() => {
                  this.is_loading = false
                  Notify.connectionError()
                })
            },
            verifyCardChargeTxn(retry_count = 1) {

              if(retry_count > 3) {
                return Notify.warning(
                  'An error occured',
                  'Unable to confirm transaction. Kindly contact support for assistance',
                  () => this.close()
                )
              }
              
              this.is_loading = true
              let { reference } = this
              let uri = utils.api_endpoint(`/me/transactions/${reference}`)

              $http.get(uri)
                .then(({data}) => {
                  let { status } = data.data
                  let status_name = status.name.toLowerCase()

                  if(status_name === 'pending') {
                    return setTimeout(() => {
                      this.verifyCardChargeTxn(retry_count + 1)
                    }, 3000)
                  }

                  if(status_name === 'ok') {
                    return Notify.success(
                      'Success',
                      `Your wallet has been successfully funded with ${data.data.amount_formatted}`,
                      () => this.close()
                    )
                  }

                  if(status_name === 'failed') {
                    return Notify.success(
                      'Failed',
                      `We were unable to charge your card. Please check card and try again later`,
                      () => this.close()
                    )
                  }

                  this.is_loading = false
                  Notify.connectionError()
                })
                .catch(() => Notify.connectionError())
            },
            openPayment() {

              let { key, email, amount, reference } = this
              let context = this
              this.is_loading = true

              let setup = getpaidSetup({
                PBFPubKey: key,
                customer_email: email,
                amount: amount,
                currency: 'NGN',
                txref: reference,
                onclose() {
                  context.cancelPayment()
                },
                callback({tx}) {
                  this.is_loading = true
                  let { txRef } = tx
                  setTimeout(() => context.verifyPayment(txRef), 3500)
                  setup.close()
                }
              })
            },
            cancelPayment() {
              this.close()
              let { reference } = this
              let uri = utils.api_endpoint(`/fund/cancel/${reference}`)
              $http.post(uri)
                .then(() => {
                })
                .finally(() => {
                  this.reset()
                })
            },
            verifyPayment(ref) {
              let uri = utils.api_endpoint(`/fund/verify/${ref}`)
              this.is_loading = true

              $http.post(uri)
                .then(({data}) => {
                    let { status } = data

                    if(status === 'ok') {
                      return Notify.success(
                        data.msg,
                        data.data.msg
                      )
                    }

                    if(status === 'error') {
                      return Notify.error(
                        data.msg,
                        data.data.msg
                      )
                    }

                    Notify.connectionError()
                })
                .catch(() => Notify.connectionError())
                .finally(() => this.is_loading = false)
            }
          }">
          <div class="space-y-5">
            <div>
              <label
                class="text-gray-600"
                for="fund-amount">
                Amount:
              </label>
              <input
                type="number"
                class="w-full h-12 px-2 mt-1 border rounded-lg outline-none focus:ring ring-atg-light"
                placeholder="Enter amount"
                x-model="amount"
                id="fund-amount"
                :disabled="is_loading">
            </div>

            <template x-if="cards.length">
              <div class="pt-4 border-t">
                <div class="text-sm font-medium lg:text-gray-600">
                  Choose A Card:
                </div>
                <ul class="mt-3 space-y-3">
                  <template x-for="card in cards">
                  <li>
                    <a
                      @click.prevent="selected_card = card"
                      href=""
                      class="flex items-center justify-between p-3 text-xs border rounded-lg lg:text-sm bg-gray-50"
                      :class="selected_card.id == card.id ? 'ring-2 ring-atg-light' : ''">
                      <div class="flex gap-x-6">
                        <div>
                          <i
                            class="fa fa-circle"
                            :class="selected_card.id == card.id ? 'text-atg' : 'text-gray-500'"></i>
                        </div>
                        <div
                          class="text-gray-600"
                          x-text="card.pan"></div>
                      </div>
                      <div>
                        <img
                          class="h-4"
                          :src="card.image_url"
                          alt="">
                      </div>
                    </a>
                  </li>
                  </template>
                  <li>
                    <a
                      @click.prevent="selected_card = {id: new_card_id}"
                      href=""
                      class="flex items-center justify-between p-3 text-xs border rounded-lg lg:text-sm bg-gray-50"
                      :class="selected_card.id == new_card_id ? 'ring-2 ring-atg-light' : ''">
                      <div class="flex gap-x-6">
                        <div>
                          <i
                            class="fa fa-circle"
                            :class="selected_card.id == new_card_id ? 'text-atg' : 'text-gray-500'"></i>
                        </div>
                        <div class="text-gray-600">Use New Card</div>
                      </div>
                      <div>
                        <i class="fa fa-credit-card"></i>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
            </template>

            <div>
              <button
                :disabled="button_disabled()"
                class="w-full p-3 text-white rounded-lg bg-atg"
                :class="button_disabled() ? 'opacity-70 cursor-not-allowed' : ''">
                <template x-if="is_loading">
                  <span>
                    <i class="fa fa-spin fa-circle-notch"></i>
                    Please wait..
                  </span>
                </template>
                <template x-if="!is_loading">
                  <span>
                    Continue
                  </span>
                </template>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script
  async
  type="text/javascript"
  src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script>  </main>
</body>

</html>