
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#ab2923">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="csrf-token" content="1c13814e2dfc19122f8e5f242c1a69039d8daf3e">
  <meta name="google-site-verification" content="c_LAXHEHxcNq1-aJO5h6KHVhmuVz7pgsfx9HbbN7BXg" />
    <meta name="description"
    content="Fastest and easiest way to convert your airtime to cash. Accept payments for your business and services today using airtime." />
  
    <meta name="keywords"
    content="Easiest way to convert airtime to cash in Nigeria, Make payment with airtime, Send and recieve payment in Nigeria with airtime, airtime is money, buy cheap data, MTN, Glo, 9mobile, Airtel, make payment for Gotv, Dstv" />
    <meta property="og:image" content="https://aimtoget.com/assets/images/new/favicon.png">
  <title>Transfer Funds
</title>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/styles.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2.5/fonts.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/iziToast.min.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/css/v2/sweetalert2.min.css?v=2.5.6998 "/>
  <link rel="stylesheet" href="https://aimtoget.com/assets/fontawesome-free-6.1.2-web/css/all.min.css">
  <link rel="icon" href="https://aimtoget.com/assets/images/new/atg-favicon.png">
  <link rel="stylesheet" href="assets/fontawesome-free-6.1.2-web/css/all.min.css">
  <script src="https://aimtoget.com/assets/js/v2/alpine.persist.min.js" defer></script>
  <script src="https://aimtoget.com/assets/js/v2/alpine.intersect.min.js" defer></script>
  <script defer src="https://aimtoget.com/assets/js/v2/alpine.min.js"></script>
  <script src="https://aimtoget.com/assets/js/axios.min.js?v=2.5.6998"></script>
  <script>const BASE_URL = 'https://aimtoget.com';</script>
  <script src="https://aimtoget.com/assets/js/v2/iziToast.min.js?v=2.5.6998"></script>
  <script src="https://aimtoget.com/assets/js/v2/sweetalert2.all.min.js?v=2.5.6998"></script>
  <script src="https://aimtoget.com/assets/js/v2/utils.js?v=2.5.6998"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90432823-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-90432823-1');
  </script>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
    h2{
      font-weight:700;
      font-size: 20px;
    }
    .free{
      font-size: 14px;
    }
    .earners{
      background-color: rgba(209, 168, 168, 0.267);
      padding: 20px;
      border-radius: 5px;
    }
    b{
      background-color: rgb(3, 175, 80);
      padding: 3px;
      border-radius: 10%;
      color: white;
    }
    .refer{
      background-color: rgb(212, 3, 3);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 13px;
      float: right;
      margin-top: 5%;
    }
    .earner{
      background-color: rgba(135, 179, 190, 0.267);
      padding: 20px;
      border-radius: 5px;
    }
    .ref-btn{
      background-color: rgb(4, 88, 167);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 13px;
      float: right;
      margin-top: 5%;
    }
    /* Media query for small screen sizes */
@media only screen and (max-width: 767px) {
  /* CSS rules for small screen sizes */
  /* For example, you can adjust font sizes, margins, or padding */
  .earners, .mola{
    margin-top: 20%;
  }
}

</style>
    </head>

<body
  class="bg-white"
  :class="(sidebar_open || is_fund_modal_open) ? 'overflow-hidden h-full' : ''"
  x-init="() => {
    $refs.sidebar.classList.remove('-left-72')
  }"
  x-data="{
    sidebar_open:false,
    is_fund_modal_open: false,
    openNairaPin() {
      Notify.error(
        'Service Unavailable!',
        'Naira pin is currently unavailable. Please check back later.'
      )
    }
  }">
  <aside
    x-ref="sidebar"
    class="fixed inset-y-0 px-6 py-5 text-sm text-gray-800 duration-300 bg-gray-100 border-r -left-72 lg:left-0 w-72"
    :class="sidebar_open ? 'left-0 z-40' : '-left-72 lg:left-0'">
    
    <div class="p-5 bg-white rounded-lg shadow">
      <div class="flex items-center justify-between">
        <div>
          <a href="">
            princejboy
          </a>
        </div>
        <div>
          <a href="login.html">
            <i class="fa fa-power-off"></i>
          </a>
        </div>
      </div>
    </div>

    <ul class="mt-10 space-y-8">
      <li>
        <ul class="space-y-4">
          <li>
            <a
              class="block duration-300 hover:text-primary-main"
              href="dashboard.html">
              <i class="fas fa-tachometer-alt"></i>
              <span class="inline-block ml-1">
                Dashboard
              </span>
            </a>
          </li>
          
        </ul>
      </li>

      <li>
        <div class="font-medium text-gray-500">
          Main
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              href="sponsored-post.html"
              class="duration-300 hover:text-primary-main">
              <i class="fab fa-pushed"></i>
              <span class="inline-block ml-1">
                Sponsored Post
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="perform-task.html">
              <i class="fas fa-tasks"></i>
              <span class="inline-block ml-1">
                Perform Task
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="withdraw.html">
              <i class="fa fa-wallet"></i>
              <span class="inline-block ml-1">
                Withdraw Funds
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="top-earners.html">
              <i class="fa fa-users"></i>
              <span class="inline-block ml-1">
                Top Earners
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="spin.html">
              <i class="fa fa-spinner"></i>
              <span class="inline-block ml-1">
                Spin and Win
              </span>
            </a>
          </li>
        </ul>
      </li>

      <li>
        <div class="font-medium text-gray-500">
          Services
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="settings.html">
              <i class="fas fa-bank"></i>
              <span class="inline-block ml-1">
                Update Bank
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="support.html">
              <i class="fas fa-headphones"></i>
              <span class="inline-block ml-1">
                Support
              </span>
            </a>
          </li>
          
      <li>
        <div class="font-medium text-gray-500">
          Settings
        </div>
        <ul class="mt-2 space-y-3">
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="settings.html">
              <i class="fas fa-cog"></i>
              <span class="inline-block ml-1">
                Account Settings
              </span>
            </a>
          </li>
          <li>
            <a
              class="duration-300 hover:text-primary-main"
              href="login.html">
              <i class="fas fa-power-off"></i>
              <span class="inline-block ml-1">
                Logout
              </span>
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </aside>
  <main class="lg:ml-72">
    <header class="fixed inset-x-0 top-0 z-10 px-5 py-3 bg-white border-b lg:z-0 lg:relative">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-x-5">
          <div class="flex items-center lg:hidden">
            <a 
              href="" 
              @click.prevent="sidebar_open = !sidebar_open"
              class="flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full">
              <i class="fas fa-bars"></i>
            </a>
          </div>
          <div>
            <a href="https://aimtoget.com/app">
              <img
                class="h-6 lg:h-7"
                src="logo.png"
                alt="">
            </a>
          </div>
        </div>
        <div class="flex items-center gap-x-3 lg:gap-x-5">
          <a
            x-data="{
              show_balance: $persist(false).as('atg_balance_show')
            }"
            x-init="() => {
              window.addEventListener('show_hide_balance', e => {
                show_balance = !show_balance
              })
            }"
            @click.prevent="show_balance = !show_balance"
            href=""
            class="hidden px-2 py-1 text-sm text-white duration-300 rounded lg:block lg:px-3 lg:py-2 hover:bg-primary-600 bg-primary-main">
            ₦ 
            <span
              x-cloak
              :class="show_balance ? '' : 'hidden'">
              19,920.00
            </span>
            <span
              x-cloak
              :class="show_balance ? 'hidden' : ''">
              ******
            </span>
          </a>
          <a
            href="settings.html"
            class="px-1 text-gray-800 lg:text-xl lg:px-2 lg:py-1 hover:bg-gray-100 rounded-xl">
            <i class="fa fa-cog"></i>
          </a>
          
        </div>
      </div>
    </header>

    <div style="margin-top: 2px; width: 95%; margin-left: 12px;" class="mt-5 lg:mt-10  mola">
        <div class="earners">
            <div class="flex text-sm lg:hidden gap-x-4">
                <span class="font-medium text-gray-700">
                  Total Earnings:
                </span>
                <div class="font-bold">
                  158.
                </div>
              </div>
              <div class="border-t lg:hidden"></div>
      
              <div class="grid grid-cols-2 lg:gap-x-10">
                                    <div class="text-sm lg:text-base">
                  <div style="font-weight: 400;" class="text-sm font-light text-gray-700">
                    Referral Earnings:
                  </div>
                  <div class="font-bold">
                    ₦200,000
                  </div>
                </div>
                          <div class="hidden text-sm lg:block lg:text-base">
                  <div class="text-sm text-gray-700">
                    Total Referals:
                  </div>
                  <div class="font-medium">
                    56
                  </div>
                </div>
                        </div>
      
              <div
                x-init="() => {
                  console.log(calculate_pct())
                }"
                x-data="{
                  calculate_pct() {
                    return (0 / 200000) * 100
                  }
                }">
                <div class="w-full h-2 overflow-hidden bg-gray-200 rounded-lg lg:h-3 lg:mt-8">
                  <div
                    class="h-full bg-primary-600"
                    :style="`width: ${calculate_pct()}%`"
                    x-cloak></div>
                </div>
              </div>
              <div class=" mt-3 text-sm font-light text-right lg:block">
                [<a 
                  class="font-medium hover:underline text-atg"
                  href="#">
                  Copy Link
                </a>]
              </div>
            </div>
        </div>
    </div>
    <br>
    
    <div class="container relative z-0 px-5 pb-10 mx-auto mt-16 lg:mt-0">
      <h1 class="pt-0 text-xl font-light lg:text-2xl">
        Withdraw <span class="font-medium">Earnings</span></h1>
        <p style="font-size: 13px; color: brown; background-color: rgba(255, 0, 0, 0.075); padding: 10px;border-radius: 5px;"> <i class="fa fa-warning"></i> The minimum withdrawal is <b style="background: none;color: brown;">N1,000</b> for referral earners & <b style="background: none;color: brown;">N3,000</b> for activities earners.</p>

<section class="mt-5 lg:mt-10">
  <div class="grid grid-cols-1 lg:grid-cols-11 lg:gap-x-20" x-init="() => {
      setTimeout(() => selected_method = methods.BANK, 10)
      $watch('selected_method', value => {
        if (value == methods.BANK) {
           loadBanks()
        }
        
        beneficiary = ''
        account_name = ''
        selected_bank = null
      })
    }" x-data="{
      current_tab: 1,
      service_id: 29,
      tabs: {
        FORM: 1,
        CONFIRM: 2
      },
      selected_method: null,
      methods: {
        BANK: 2
      },
      validateRecipient() {
        if(this.selected_method != this.methods.BANK) {
          return
        }
        
        this.resolveBankAccount()
      },
      beneficiaries: [],
      loadBeneficiaries() {
        this.is_loading = true
        let { service_id, beneficiaries } = this

        console.log(beneficiaries)
        if(beneficiaries.length > 0) {
          return
        }

        let uri = utils.api_endpoint('/service-beneficiaries', {
          service_id,
          limit: 3
        })

        $http.get(uri)
          .then(({data}) => {
            
            if(data.status !== 'ok') {
              return
            }
            this.beneficiaries = data.data ? data.data : []
          })
          .finally(() => this.is_loading = false)
      },
      selectBeneficiary({beneficiary, item_id}) {
        this.beneficiary = beneficiary
        this.bank_code = item_id
        let selected_bank_index = this.banks_list.findIndex(bank => bank.code == item_id)
        this.selected_bank = this.banks_list[selected_bank_index]
        this.resolveBankAccount()
      },

      beneficiaries_list() {
        return this.beneficiaries
      },
      
      pin: '',
      amount: '',
      beneficiary: '',
      is_loading: false,
      save_beneficiary: true,
      banks_list: [],

      account_name: '',
      selected_bank: null,
      loadBanks() {
        this.is_loading = true
        let uri = utils.api_endpoint('/transfer/banklist')
        $http.get(uri)
          .then(({data}) => {
            this.banks_list = data.data.banks
            this.loadBeneficiaries()
          })
          .finally(() => this.is_loading = false)
      },
      resolveBankAccount() {
        this.is_loading = true
        let { selected_bank, beneficiary } = this
        let { code } = selected_bank
        
        let uri = utils.api_endpoint('/banks/resolveaccount')
        let params = {
          bank_code: code,
          account_number: beneficiary
        }

        $http.post(uri, params)
          .then(({data}) => {
            if(data.status === 'ok') {
              return this.account_name = data.data.name
            }
            Notify(data.msg, data.data.msg)
          })
          .catch(err => {

          })
          .finally(() => this.is_loading = false)
      },
      reset() {
        this.beneficiary = ''
        this.pin = ''
        this.amount = ''
        this.selected_bank = null
        this.current_tab = this.tabs.FORM
        this.account_name = ''
      }
    }">
    <div class="relative p-6 border border-t-4 rounded-lg shadow lg:col-span-4 bg-gray-50 lg:p-10 border-t-primary-main"
      :class="current_tab == tabs.FORM ? '' : 'hidden lg:block lg:blur-sm'">
      <div class="absolute inset-0 z-10 bg-transparent" :class="current_tab == tabs.FORM ? 'hidden' : ''">
      </div>
      <form action="" method="post" class="text-sm" @submit.prevent="current_tab = tabs.CONFIRM">
        <div class="space-y-6">

          <div>
            <label class="text-sm text-gray-500" for="phone">
              Withdraw To:
            </label>
            <div class="grid grid-cols-2 gap-5 mt-1">
              <div class="flex items-center px-3 py-2 text-xs border rounded cursor-pointer gap-x-2"
                :class="selected_method == methods.BANK ? 'border-primary-100 bg-white' : ''"
                @click="selected_method = methods.BANK">
                <div>
                  <i class="fa fa-check-circle"
                    :class="selected_method == methods.BANK ? 'text-primary-main' : 'text-gray-300'"></i>
                </div>
                <div>
                  <div class="font-medium">
                    Bank Account
                  </div>
                </div>
              </div>
                          </div>
          </div>

          <div class="space-y-6" :class="selected_method == methods.BANK ? '' : 'hidden'">
            
<div
  :class="beneficiaries_list()?.length > 0 ? '' : 'hidden'">
  <label
    class="text-sm text-gray-500"
    for="tel">
    Recently Used:
  </label>
  <div class="flex mt-2 overflow-x-scroll">
    <template x-for="xbeneficiary in beneficiaries_list">
      <div
        class="w-24 mr-5 overflow-hidden text-xs text-center rounded-lg bg-atg-light">
        <a 
          class="block p-3"
          @click.prevent="selectBeneficiary(xbeneficiary)"
          href="">
          <div>
            <i class="text-2xl fa fa-user-circle"></i>
          </div>
          <div
            class="text-center whitespace-nowrap font-medium text-[10px]"
            x-text="xbeneficiary.tag"></div>
        </a>
      </div>
    </template>
  </div>
</div>            <div x-init="() => {
    document.body.addEventListener('click', ({target}) => {
      if(target.hasAttribute('data-banklist-close')) {
        return close()
      }
      
      is_opened = target == $refs.banks_list_input || target.hasAttribute('data-banklist-dropdown')

      if(is_opened) {
        $refs.banks_list_input.focus()
      }
    })
    
    $watch('selected_bank', val => {
      keyword = val ? val.name : ''
    })
  }" x-data="{
    keyword: '',
    is_opened: false,
    filtered_list() {
      let { keyword } = this
      if(!keyword) {
        return this.banks_list
      }

      return this.banks_list.filter(bank => {
        return bank.name.toLowerCase().includes(keyword.toLowerCase())
      })
    },
    selectBank(bank) {
      this.selected_bank = bank
      this.keyword = bank.name
      this.is_opened = false
    },
    close() {
      if(this.keyword) {
        this.$refs.banks_list_input.focus()
        return this.keyword = ''
      }
      
      this.is_opened = false
    }
  }">
  <label class="text-sm text-gray-500" for="banks">
    Bank Name:
  </label>

  <div>
    <input type="text"
      class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
      placeholder="Enter your bank name" >
  </div>
</div>

<div>
    <label class="text-sm text-gray-500" for="banks">
        Account Name:
      </label>
    <input type="text"
      class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
      placeholder="Enter your name" >
  </div>
</div>
  
          <div>
            <label class="text-sm text-gray-500" for="tel"
              x-text="selected_method == methods.BANK ? 'Account Number:' : 'Username / Phone:'">
            </label>
            <input type="tel"
              class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
              :placeholder="'Beneficiary\'s ' + (selected_method == methods.BANK ? 'Account Number:' : 'Username / Phone:')"
              required>
            <div class="mt-1 text-xs" :class="account_name ? '' : 'hidden'" x-text="account_name"></div>
          </div>
          <div>
            <label class="text-sm text-gray-500" for="amount">
              Amount:
            </label>
            <input type="text"
              class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
              placeholder="Amount to transfer" >
          </div>
          <div>
            <div class="flex items-center text-sm gap-x-2">
              <a @click.prevent="save_beneficiary = !save_beneficiary"
                class="flex items-center w-8 h-5 px-1 duration-300 bg-gray-200 rounded-lg cursor-pointer"
                :class="save_beneficiary ? 'justify-end' : 'justify-start'">
                <span class="block w-3 h-3 duration-300 rounded-full"
                  :class="save_beneficiary ? 'bg-primary-main' : 'bg-gray-600'"></span>
              </a>

              <span class="text-gray-600">
                Save Beneficiary
              </span>
            </div>
          </div>
          <div class="pt-3">
            <button class="w-full px-6 py-2 tracking-wide text-white duration-300 rounded lg:py-3 e bg-primary-main"
              
              x-text="'Continue'">
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="lg:col-span-4" :class="current_tab == tabs.CONFIRM ? '' : 'hidden'" x-cloak>
      <form action="" @submit.prevent="transfer" x-data="{
          description: '',
          transferToBank() {
            let { selected_bank, beneficiary, description, amount, pin } = this
            this.is_loading = true

            let uri = utils.api_endpoint('/bank-transfer')
            let params = {
              bank_code: selected_bank.code,
              account_number: beneficiary,
              description,
              amount,
              pin
            }

            $http.post(uri, params)
              .then(({data}) => {
                console.log(data)

                if(data.status === 'ok') {
                  return Notify.success(
                    data.msg,
                    data.data.msg,
                    () => this.reset()
                  )
                }
                
                if(data.status === 'error') {
                  return Notify.error(
                    data.msg,
                    data.data.msg,
                    () => {
                      this.pin = ''
                      this.current_tab = this.tabs.FORM
                    }
                  )
                }
                
                Notify.connectionError()
              })
              .catch(err => {
                Notify.connectionError()
              })
              .finally(() => this.is_loading = false)
            
          },
          transferToUser() {
            return alert('Service is unavailable')
          },
          transfer() {
            this.selected_method == this.methods.BANK
              ? this.transferToBank()
              : this.transferToUser()
          } 
        }">
        <div class="p-5 text-sm text-gray-600 border-t-4 rounded-lg shadow bg-gray-50 lg:p-10 border-primary-main">
          <div class="space-y-6">
            <div>
              <a href="" @click.prevent="current_tab = tabs.FORM"
                class="inline-flex items-center px-2 py-1 text-xs font-medium duration-300 bg-white border rounded gap-x-1 hover:shadow">
                <i class="fa fa-times"></i>
                <span>Cancel</span>
              </a>
            </div>
            <div class="flex items-center justify-between">
              <div>
                Amount:
              </div>
              <div class="font-medium" x-text="'N' + Intl.NumberFormat('en-US').format(amount)"></div>
            </div>
            <div class="flex items-center justify-between">
              <div x-text="selected_method == methods.BANK ? 'Account Number:' : 'Beneficiary:'">
              </div>
              <div class="font-medium" x-text="beneficiary"></div>
            </div>
            <div class="space-y-6" :class="selected_method == methods.BANK ? '' : 'hidden'">
              <div class="flex items-center justify-between">
                <div>
                  Bank:
                </div>
                <div class="font-medium" x-text="selected_bank ? selected_bank.name : ''"></div>
              </div>
              <div class="flex items-center justify-between">
                <div>
                  Account Name:
                </div>
                <div class="font-medium text-right" x-text="account_name"></div>
              </div>
            </div>
            <div class="pt-3" :class="selected_method == methods.BANK ? '' : 'hidden'">
              <label class="text-sm text-gray-500" for="description">
                Description:
              </label>
              <input type="text"
                class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
                placeholder="Narration" x-model="description" maxlength="15" :disabled="is_loading">
            </div>
            <div>
              <label class="text-sm text-gray-500" for="pin">
                Pin:
              </label>
              <input @keyup="$el.type = 'password'" type="text"
                class="w-full h-10 px-2 mt-1 bg-white border rounded outline-none ring-primary-100 focus:ring-2"
                placeholder="Your Transaction Pin" x-model="pin" maxlength="4" :disabled="is_loading">
            </div>
            <div>
              <button class="w-full px-6 py-2 tracking-wide text-white duration-300 rounded lg:py-3 e bg-primary-main"
                :class="(is_loading || !pin) ? 'opacity-60 cursor-not-allowed' : 'hover:bg-primary-600 hover:shadow-md'"
                :disabled="is_loading || !pin">
                <span :class="is_loading ? '' : 'hidden'">
                  <i class="fa fa-spin fa-circle-notch"></i>
                  Please wait...
                </span>
                <span :class="is_loading ? 'hidden' : ''">
                  Send Cash
                </span>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>
    </div>
    
    
<div
  class="fixed inset-0 z-30 bg-black bg-opacity-60"
  :class="sidebar_open ? '' : 'hidden'"
  @click.prevent="sidebar_open = false" x-cloak></div>

<div
  x-cloak
  x-data="{
    is_copying: false,
    current_view: 1,
    views: {
      INDEX: 1,
      ATM_FUND: 2
    },
    close() {
      this.current_view = this.views.INDEX
      this.is_fund_modal_open = false
    },
    goto(uri) {
      this.close()
      location.href = uri
    },
    copyAccountNumber(acn) {
      navigator.clipboard.writeText(acn).then(() => {
        iziToast.success({
          message: 'Account number copied',
          position: 'topCenter',
          timeout: 3000
        })
      })
    }
  }"
  $ref="container"
  class="fixed inset-0 z-50 flex items-end justify-center bg-black lg:shadow-xl lg:items-center bg-opacity-70"
  x-show="is_fund_modal_open"
  x-transition
  x-transition.opacity>
  <div class="w-full p-10 bg-white rounded-lg lg:w-3/12">
    <div
      :class="current_view == views.INDEX ? '' : 'hidden'">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-semi-bold">
            Add Funds
          </div>
          <div class="text-sm font-light text-gray-500">
            How do you want to topup?
          </div>
        </div>
        <div>
          <a
            class="text-gray-500"
            @click.prevent="close"
            href="">
            <i class="fa fa-times-circle"></i>
          </a>
        </div>
      </div>
                  <div>
        <div class="flex items-center justify-between px-5 py-3 mt-5 bg-gray-100 border border-gray-300 rounded-lg">
          <div>
            <div class="text-xl font-semibold">
              2056667112
            </div>
            <div class="text-gray-600">
              Kuda Bank
            </div>
          </div>
          <div>
            <a
              @click.prevent="copyAccountNumber(2056667112)"
              href="">
              <i class="text-gray-600 fa fa-copy"></i>
            </a>
          </div>
        </div>
        <div class="mt-2">
          <div
            :class="is_copying ? '' : 'hidden'"
            class="text-xs text-atg">Account number copied...</div>
          <div class="text-xs text-gray-600">
            Transfer to this account to fund your wallet.
          </div>
        </div>
      </div>
            <div>
  
      </div>
      <ul class="mt-8 border-t">
        <li class="py-5 border-b border-gray-200">
          <a 
            href=""
            @click.prevent="goto('https://aimtoget.com/app/airtime/fund')">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">Airtime</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Convert your airtime to cash
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
        <li class="py-5 border-b border-gray-200">
          <a
            href=""
            @click.prevent="current_view = views.ATM_FUND">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">ATM Card</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Fund your wallet using ATM Card
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
        <li class="py-5 border-b border-gray-200">
          <a
            href=""
            @click.prevent="openNairaPin">
            <div class="flex items-center justify-between">
              <div>
                <div>
                  <span class="text-atg">Naira Pin</span>
                </div>
                <div class="text-sm font-light text-gray-600">
                  Load Aimtoget wallet with naira-pin
                </div>
              </div>
              <div>
                <i class="fa fa-angle-right"></i>
              </div>
            </div>
          </a>
        </li>
      </ul>
    </div>
    <div
      :class="current_view === views.ATM_FUND ? '' : 'hidden'">
      <div class="flex items-center justify-between">
        <div class="text-sm">
          <a
            class="inline-block px-2 py-1 bg-gray-100 border rounded-lg"
            @click.prevent="current_view = views.INDEX"
            href="">
            <i class="fa fa-angle-left"></i>
            <span class="ml-1 text-gray-600">Back</span>
          </a>
        </div>
        <div>
          <a
            class="text-gray-500"
            @click.prevent="close"
            href="">
            <i class="fa fa-times-circle"></i>
          </a>
        </div>
      </div>
      <div class="mt-5">
        <div class="text-xl lg:text-2xl font-semi-bold">
          ATM Card
        </div>
        <div class="text-xs font-light text-gray-500 lg:text-sm">
          Add funds with ATM Card
        </div>
      </div>
      <div class="pt-10">
        <form
          action=""
          method="post"
          @submit.prevent="process"
          x-data="{
            cards: [],
            new_card_id: 'new_card',
            selected_card: {},
            amount: '',
            key: '',
            reference: '',
            is_loading: false,
            has_loaded_cards: false,
            process() {

              if(!this.reference) {
                return this.prepare()
              }

              if(!this.has_loaded_cards) {
                return
              }

              let { selected_card, new_card_id } = this

              if(selected_card.id === new_card_id) {
                return this.openPayment()
              }
              
              this.chargeSavedCard()
            },
            button_disabled() {
              if(this.amount < 1) {
                return true
              }

              if(this.is_loading) {
                return true
              }

              if(this.cards.length && !this.selected_card) {
                return true
              }

              return false
            },
            reset() {
              this.key = '',
              this.reference = '',
              this.is_loading = false
              this.amount = ''
            },
            prepare() {
              this.is_loading = true
              let { amount } = this
              let uri = utils.api_endpoint('/fund-atm/reference')
              
              $http.post(uri, {amount})
                .then(({data}) => {
                  let { status } = data

                  if(status === 'error') {
                    this.is_loading = false
                    return Notify.error(
                      data.msg,
                      data.data.msg
                    )
                  }

                  if(status === 'ok') {
                    let { amount, email, rave, reference } = data.data
                    this.email = email
                    this.reference = reference
                    this.key = rave.public_key
                    return this.loadSavedCards()
                  }
                })
                .catch(err => {
                  console.log(err)
                  this.is_loading = false
                  Notify.connectionError()
                })
            },
            loadSavedCards() {
              
              if(this.cards.length) {
                return
              }

              let uri = utils.api_endpoint('/me/cards')
              this.is_loading = true

              $http.get(uri)
                .then(({data}) => {
                  let { status } = data

                  if(status === 'ok') {
                    this.is_loading = false
                    this.cards = data.data.cards
                    this.has_loaded_cards = true
                    return
                  }
                  
                  this.openPayment()
                })
                .finally(() => {
                  has_loaded_cards = true
                })
            },
            chargeSavedCard() {
              let uri = utils.api_endpoint('/fund/card')
              let { reference, selected_card } = this
              let params = {
                reference,
                card: selected_card.id
              }

              this.is_loading = true
              $http.post(uri, params)
                .then(({data}) => {
                  let { status } = data

                  if(status === 'processing') {
                    return this.verifyCardChargeTxn()
                  }

                  this.is_loading = false

                  if(status === 'ok') {
                    return Notify.success(
                      data.msg,
                      data.data.msg,
                      () => {
                        this.reset()
                        this.close()
                      }
                    )
                  }

                  if(status === 'error') {
                    return Notify.error(
                      data.msg,
                      data.data.msg
                    )
                  }

                  Notify.connectionError()
                })
                .catch(() => {
                  this.is_loading = false
                  Notify.connectionError()
                })
            },
            verifyCardChargeTxn(retry_count = 1) {

              if(retry_count > 3) {
                return Notify.warning(
                  'An error occured',
                  'Unable to confirm transaction. Kindly contact support for assistance',
                  () => this.close()
                )
              }
              
              this.is_loading = true
              let { reference } = this
              let uri = utils.api_endpoint(`/me/transactions/${reference}`)

              $http.get(uri)
                .then(({data}) => {
                  let { status } = data.data
                  let status_name = status.name.toLowerCase()

                  if(status_name === 'pending') {
                    return setTimeout(() => {
                      this.verifyCardChargeTxn(retry_count + 1)
                    }, 3000)
                  }

                  if(status_name === 'ok') {
                    return Notify.success(
                      'Success',
                      `Your wallet has been successfully funded with ${data.data.amount_formatted}`,
                      () => this.close()
                    )
                  }

                  if(status_name === 'failed') {
                    return Notify.success(
                      'Failed',
                      `We were unable to charge your card. Please check card and try again later`,
                      () => this.close()
                    )
                  }

                  this.is_loading = false
                  Notify.connectionError()
                })
                .catch(() => Notify.connectionError())
            },
            openPayment() {

              let { key, email, amount, reference } = this
              let context = this
              this.is_loading = true

              let setup = getpaidSetup({
                PBFPubKey: key,
                customer_email: email,
                amount: amount,
                currency: 'NGN',
                txref: reference,
                onclose() {
                  context.cancelPayment()
                },
                callback({tx}) {
                  this.is_loading = true
                  let { txRef } = tx
                  setTimeout(() => context.verifyPayment(txRef), 3500)
                  setup.close()
                }
              })
            },
            cancelPayment() {
              this.close()
              let { reference } = this
              let uri = utils.api_endpoint(`/fund/cancel/${reference}`)
              $http.post(uri)
                .then(() => {
                })
                .finally(() => {
                  this.reset()
                })
            },
            verifyPayment(ref) {
              let uri = utils.api_endpoint(`/fund/verify/${ref}`)
              this.is_loading = true

              $http.post(uri)
                .then(({data}) => {
                    let { status } = data

                    if(status === 'ok') {
                      return Notify.success(
                        data.msg,
                        data.data.msg
                      )
                    }

                    if(status === 'error') {
                      return Notify.error(
                        data.msg,
                        data.data.msg
                      )
                    }

                    Notify.connectionError()
                })
                .catch(() => Notify.connectionError())
                .finally(() => this.is_loading = false)
            }
          }">
          <div class="space-y-5">
            <div>
              <label
                class="text-gray-600"
                for="fund-amount">
                Amount:
              </label>
              <input
                type="number"
                class="w-full h-12 px-2 mt-1 border rounded-lg outline-none focus:ring ring-atg-light"
                placeholder="Enter amount"
                x-model="amount"
                id="fund-amount"
                :disabled="is_loading">
            </div>

            <template x-if="cards.length">
              <div class="pt-4 border-t">
                <div class="text-sm font-medium lg:text-gray-600">
                  Choose A Card:
                </div>
                <ul class="mt-3 space-y-3">
                  <template x-for="card in cards">
                  <li>
                    <a
                      @click.prevent="selected_card = card"
                      href=""
                      class="flex items-center justify-between p-3 text-xs border rounded-lg lg:text-sm bg-gray-50"
                      :class="selected_card.id == card.id ? 'ring-2 ring-atg-light' : ''">
                      <div class="flex gap-x-6">
                        <div>
                          <i
                            class="fa fa-circle"
                            :class="selected_card.id == card.id ? 'text-atg' : 'text-gray-500'"></i>
                        </div>
                        <div
                          class="text-gray-600"
                          x-text="card.pan"></div>
                      </div>
                      <div>
                        <img
                          class="h-4"
                          :src="card.image_url"
                          alt="">
                      </div>
                    </a>
                  </li>
                  </template>
                  <li>
                    <a
                      @click.prevent="selected_card = {id: new_card_id}"
                      href=""
                      class="flex items-center justify-between p-3 text-xs border rounded-lg lg:text-sm bg-gray-50"
                      :class="selected_card.id == new_card_id ? 'ring-2 ring-atg-light' : ''">
                      <div class="flex gap-x-6">
                        <div>
                          <i
                            class="fa fa-circle"
                            :class="selected_card.id == new_card_id ? 'text-atg' : 'text-gray-500'"></i>
                        </div>
                        <div class="text-gray-600">Use New Card</div>
                      </div>
                      <div>
                        <i class="fa fa-credit-card"></i>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
            </template>

            <div>
              <button
                
                class="w-full p-3 text-white rounded-lg bg-atg"
                >
                
                <template>
                  <span>
                    Continue
                  </span>
                </template>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script
  async
  type="text/javascript"
  src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script>  </main>
</body>

</html>